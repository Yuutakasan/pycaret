# åº—èˆ—é–“æ¯”è¼ƒã‚°ãƒ©ãƒ•æ–‡å­—åŒ–ã‘ä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025å¹´10æœˆ9æ—¥
**å¯¾è±¡**: Phase1 ã€æ©Ÿèƒ½5ã€‘åº—èˆ—é–“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ
**ä¿®æ­£è€…**: Claude Code

---

## ğŸ” å•é¡Œã®ç‰¹å®š

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å ±å‘Š

```
åº—èˆ—é–“æ¯”è¼ƒã®ã‚°ãƒ©ãƒ•ãŒæ–‡å­—åŒ–ã‘ã—ã¦ã„ã¾ã™ã€‚ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚
```

å®Ÿè¡Œæ™‚ã®ã‚¨ãƒ©ãƒ¼å‡ºåŠ›:
```
ã€æ©Ÿèƒ½5ã€‘åº—èˆ—é–“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ
findfont: Generic family 'sans-serif' not found...
(warnings repeated 5 times)
```

### å•é¡Œã®åŸå› 

**Phase1 Cell 19** ã®åº—èˆ—é–“æ¯”è¼ƒã‚°ãƒ©ãƒ•ã§ã€`pandas.DataFrame.plot()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚°ãƒ©ãƒ•ã‚’ä½œæˆã—ã¦ã„ãŸãŒã€ã“ã®æ–¹æ³•ã§ã¯:

1. **xè»¸ã«æ—¥æœ¬èªã®åˆ—åã€Œåº—èˆ—ã€ã‚’æŒ‡å®š**
2. **yè»¸ã®ticklabelsï¼ˆåº—èˆ—åï¼‰ãŒpandasã«ã‚ˆã£ã¦è‡ªå‹•ç”Ÿæˆ**
3. **è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸticklabelsã«ã¯æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®šãŒé©ç”¨ã•ã‚Œãªã„**

çµæœã¨ã—ã¦ã€yè»¸ã«è¡¨ç¤ºã•ã‚Œã‚‹åº—èˆ—åï¼ˆæ—¥æœ¬èªï¼‰ãŒæ–‡å­—åŒ–ã‘ã—ã¦ã„ãŸã€‚

### è©²å½“ã‚³ãƒ¼ãƒ‰ï¼ˆä¿®æ­£å‰ï¼‰

```python
# 1. å¹³å‡æ—¥å•†æ¯”è¼ƒ
ax1 = axes[0]
store_summary.plot(x='åº—èˆ—', y='å¹³å‡æ—¥å•†', kind='barh', ax=ax1, color=colors, legend=False)
ax1.set_title('å¹³å‡æ—¥å•†æ¯”è¼ƒ', fontsize=14, fontproperties=JP_FP)
ax1.set_xlabel('å£²ä¸Šé‡‘é¡ï¼ˆå††ï¼‰', fontsize=12, fontproperties=JP_FP)
ax1.set_ylabel('', fontproperties=JP_FP)
ax1.grid(axis='x', alpha=0.3)
# âŒ yè»¸ã®ticklabelsï¼ˆåº—èˆ—åï¼‰ã«ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šãªã—

# 2. å¹³å‡å®¢å˜ä¾¡æ¯”è¼ƒ
ax2 = axes[1]
store_summary.plot(x='åº—èˆ—', y='å¹³å‡å®¢å˜ä¾¡', kind='barh', ax=ax2, color=colors, legend=False)
ax2.set_title('å¹³å‡å®¢å˜ä¾¡ é¡§å®¢ã‚ãŸã‚Š', fontsize=14, fontproperties=JP_FP)
ax2.text(0.5, 0.95, "ğŸ’¡ ç›®æ¨™å®¢å˜ä¾¡ã¨æ¯”è¼ƒã—ã¦ãã ã•ã„", ...)
ax2.set_xlabel('å††', fontsize=12, fontproperties=JP_FP)
ax2.set_ylabel('', fontproperties=JP_FP)
ax2.grid(axis='x', alpha=0.3)
# âŒ yè»¸ã®ticklabelsï¼ˆåº—èˆ—åï¼‰ã«ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šãªã—

# 3. ã‚®ãƒ£ãƒƒãƒ—å¯è¦–åŒ–
ax3 = axes[2]
gap_data = store_summary.copy()
gap_data['ã‚®ãƒ£ãƒƒãƒ—'] = top_store_sales - gap_data['å¹³å‡æ—¥å•†']
gap_data.plot(x='åº—èˆ—', y='ã‚®ãƒ£ãƒƒãƒ—', kind='barh', ax=ax3, color=colors, legend=False)
ax3.set_title('ãƒˆãƒƒãƒ—åº—èˆ—ã¨ã®ã‚®ãƒ£ãƒƒãƒ—', fontsize=14, fontproperties=JP_FP)
ax3.set_xlabel('ã‚®ãƒ£ãƒƒãƒ—ï¼ˆå††ï¼‰', fontsize=12, fontproperties=JP_FP)
ax3.set_ylabel('', fontproperties=JP_FP)
ax3.grid(axis='x', alpha=0.3)
# âŒ yè»¸ã®ticklabelsï¼ˆåº—èˆ—åï¼‰ã«ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šãªã—
```

---

## âœ… å®Ÿæ–½ã—ãŸä¿®æ­£

### ä¿®æ­£å†…å®¹

å„ã‚°ãƒ©ãƒ•ã® `ax.grid()` å‘¼ã³å‡ºã—ç›´å¾Œã«ã€**yè»¸ticklabelsã«æ˜ç¤ºçš„ã«æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨**ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ :

```python
for label in ax.get_yticklabels():
    label.set_fontproperties(JP_FP)
```

### ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰

```python
# 1. å¹³å‡æ—¥å•†æ¯”è¼ƒ
ax1 = axes[0]
store_summary.plot(x='åº—èˆ—', y='å¹³å‡æ—¥å•†', kind='barh', ax=ax1, color=colors, legend=False)
ax1.set_title('å¹³å‡æ—¥å•†æ¯”è¼ƒ', fontsize=14, fontproperties=JP_FP)
ax1.set_xlabel('å£²ä¸Šé‡‘é¡ï¼ˆå††ï¼‰', fontsize=12, fontproperties=JP_FP)
ax1.set_ylabel('', fontproperties=JP_FP)
ax1.grid(axis='x', alpha=0.3)
for label in ax1.get_yticklabels():  # âœ… è¿½åŠ 
    label.set_fontproperties(JP_FP)  # âœ… è¿½åŠ 

# 2. å¹³å‡å®¢å˜ä¾¡æ¯”è¼ƒ
ax2 = axes[1]
store_summary.plot(x='åº—èˆ—', y='å¹³å‡å®¢å˜ä¾¡', kind='barh', ax=ax2, color=colors, legend=False)
ax2.set_title('å¹³å‡å®¢å˜ä¾¡ é¡§å®¢ã‚ãŸã‚Š', fontsize=14, fontproperties=JP_FP)
ax2.text(0.5, 0.95, "ğŸ’¡ ç›®æ¨™å®¢å˜ä¾¡ã¨æ¯”è¼ƒã—ã¦ãã ã•ã„", ...)
ax2.set_xlabel('å††', fontsize=12, fontproperties=JP_FP)
ax2.set_ylabel('', fontproperties=JP_FP)
ax2.grid(axis='x', alpha=0.3)
for label in ax2.get_yticklabels():  # âœ… è¿½åŠ 
    label.set_fontproperties(JP_FP)  # âœ… è¿½åŠ 

# 3. ã‚®ãƒ£ãƒƒãƒ—å¯è¦–åŒ–
ax3 = axes[2]
gap_data = store_summary.copy()
gap_data['ã‚®ãƒ£ãƒƒãƒ—'] = top_store_sales - gap_data['å¹³å‡æ—¥å•†']
gap_data.plot(x='åº—èˆ—', y='ã‚®ãƒ£ãƒƒãƒ—', kind='barh', ax=ax3, color=colors, legend=False)
ax3.set_title('ãƒˆãƒƒãƒ—åº—èˆ—ã¨ã®ã‚®ãƒ£ãƒƒãƒ—', fontsize=14, fontproperties=JP_FP)
ax3.set_xlabel('ã‚®ãƒ£ãƒƒãƒ—ï¼ˆå††ï¼‰', fontsize=12, fontproperties=JP_FP)
ax3.set_ylabel('', fontproperties=JP_FP)
ax3.grid(axis='x', alpha=0.3)
for label in ax3.get_yticklabels():  # âœ… è¿½åŠ 
    label.set_fontproperties(JP_FP)  # âœ… è¿½åŠ 
```

---

## ğŸ› ï¸ ä¿®æ­£ãƒ„ãƒ¼ãƒ«

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆå
`scripts/fix_store_comparison_mojibake.py`

### å‡¦ç†å†…å®¹
1. Phase1ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã®Cell 19ã‚’æ¤œå‡º
2. å„ã‚°ãƒ©ãƒ•ã® `ax.grid()` è¡Œã®ç›´å¾Œã«ticklabelsãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã‚’æŒ¿å…¥
3. ä¿®æ­£æ¸ˆã¿ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã‚’ä¿å­˜

### å®Ÿè¡Œçµæœ

```
================================================================================
                               ğŸ”§ åº—èˆ—é–“æ¯”è¼ƒã‚°ãƒ©ãƒ•ã®æ–‡å­—åŒ–ã‘ä¿®æ­£
================================================================================

ğŸ“ åº—èˆ—åˆ¥åŒ…æ‹¬ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰_v5.0_Phase1.ipynb
âœ… åº—èˆ—é–“æ¯”è¼ƒã‚°ãƒ©ãƒ•ã«æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã‚’è¿½åŠ ã—ã¾ã—ãŸ

ä¿®æ­£å†…å®¹:
  ãƒ»ax1ï¼ˆå¹³å‡æ—¥å•†æ¯”è¼ƒï¼‰ã®yè»¸ticklabelsã«JP_FPé©ç”¨
  ãƒ»ax2ï¼ˆå¹³å‡å®¢å˜ä¾¡æ¯”è¼ƒï¼‰ã®yè»¸ticklabelsã«JP_FPé©ç”¨
  ãƒ»ax3ï¼ˆã‚®ãƒ£ãƒƒãƒ—å¯è¦–åŒ–ï¼‰ã®yè»¸ticklabelsã«JP_FPé©ç”¨

================================================================================
```

---

## ğŸ“Š ä¿®æ­£ç®‡æ‰€ã¾ã¨ã‚

| ã‚°ãƒ©ãƒ•å | ä¿®æ­£å†…å®¹ | é©ç”¨å ´æ‰€ |
|---------|---------|---------|
| **å¹³å‡æ—¥å•†æ¯”è¼ƒ** (ax1) | yè»¸ticklabelsã«JP_FPé©ç”¨ | Cell 19, Line 104-105 |
| **å¹³å‡å®¢å˜ä¾¡æ¯”è¼ƒ** (ax2) | yè»¸ticklabelsã«JP_FPé©ç”¨ | Cell 19, Line 115-116 |
| **ãƒˆãƒƒãƒ—åº—èˆ—ã¨ã®ã‚®ãƒ£ãƒƒãƒ—** (ax3) | yè»¸ticklabelsã«JP_FPé©ç”¨ | Cell 19, Line 127-128 |

**ä¿®æ­£ç·æ•°**: 3ç®‡æ‰€ï¼ˆ3ã¤ã®ã‚°ãƒ©ãƒ•ï¼‰

---

## ğŸ” æŠ€è¡“çš„ãªè©³ç´°

### pandas.DataFrame.plot() ã®æŒ™å‹•

`pandas.DataFrame.plot()` ãƒ¡ã‚½ãƒƒãƒ‰ã¯å†…éƒ¨ã§matplotlibã‚’ä½¿ç”¨ã—ã¦ã‚°ãƒ©ãƒ•ã‚’ä½œæˆã™ã‚‹ãŒ:

1. **xè»¸ã«æŒ‡å®šã—ãŸåˆ—ã®å€¤**ï¼ˆã“ã®å ´åˆã€Œåº—èˆ—ã€åˆ—ã®åº—èˆ—åï¼‰ãŒ**è‡ªå‹•çš„ã«ticklabelsã¨ã—ã¦è¨­å®š**ã•ã‚Œã‚‹
2. ã“ã‚Œã‚‰ã®ticklabelsã¯**matplotlibã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ³ãƒˆ**ã§æç”»ã•ã‚Œã‚‹
3. `set_xlabel()` ã‚„ `set_title()` ã§è¨­å®šã™ã‚‹**è»¸ãƒ©ãƒ™ãƒ«ã‚„ã‚¿ã‚¤ãƒˆãƒ«ã¨ã¯åˆ¥ç‰©**

### ãªãœæ˜ç¤ºçš„ãªè¨­å®šãŒå¿…è¦ã‹

```python
ax.set_ylabel('', fontproperties=JP_FP)  # âŒ ã“ã‚Œã ã‘ã§ã¯ä¸ååˆ†
```

`set_ylabel()` ã¯**è»¸ãƒ©ãƒ™ãƒ«ï¼ˆAxis Labelï¼‰**ã®ãƒ•ã‚©ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹ãŒã€**ticklabelsï¼ˆç›®ç››ã‚Šãƒ©ãƒ™ãƒ«ï¼‰**ã®ãƒ•ã‚©ãƒ³ãƒˆã¯è¨­å®šã•ã‚Œãªã„ã€‚

```python
for label in ax.get_yticklabels():  # âœ… ticklabelsã‚’ç›´æ¥å–å¾—
    label.set_fontproperties(JP_FP)  # âœ… å„ãƒ©ãƒ™ãƒ«ã«ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š
```

ã“ã®æ–¹æ³•ã§ã€yè»¸ã«è¡¨ç¤ºã•ã‚Œã‚‹å„åº—èˆ—åï¼ˆticklabelsï¼‰ã«æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆãŒé©ç”¨ã•ã‚Œã‚‹ã€‚

---

## ğŸ¯ ä»Šå¾Œã®å¯¾ç­–

### CLAUDE.mdã¸ã®è¿½è¨˜ï¼ˆæ—¢å­˜ãƒ«ãƒ¼ãƒ«ã®æ‹¡å¼µï¼‰

æ—¢å­˜ã®ã€ŒğŸš¨ CRITICAL: Japanese Font & Mojibake Preventionã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ä»¥ä¸‹ã‚’è¿½è¨˜:

```markdown
9. **pandas.plot() with Japanese column names** - ALWAYS set fontproperties for tick labels

**Wrong:**
```python
df.plot(x='åº—èˆ—', y='å£²ä¸Š', kind='barh', ax=ax)  # âŒ tick labels will be mojibake
```

**Correct:**
```python
df.plot(x='åº—èˆ—', y='å£²ä¸Š', kind='barh', ax=ax)
for label in ax.get_yticklabels():  # âœ…
    label.set_fontproperties(JP_FP)  # âœ…
# Also for x-axis if it contains Japanese:
for label in ax.get_xticklabels():  # âœ…
    label.set_fontproperties(JP_FP)  # âœ…
```
```

---

## âœ… æ¤œè¨¼

### ä¿®æ­£ç¢ºèªã‚³ãƒãƒ³ãƒ‰

```bash
python3 -c "
import json
with open('åº—èˆ—åˆ¥åŒ…æ‹¬ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰_v5.0_Phase1.ipynb', 'r') as f:
    nb = json.load(f)
cell = nb['cells'][19]
source = ''.join(cell['source'])
# 'for label in ax' ãŒ3å›ç™»å ´ã™ã‚Œã°OK
import re
count = len(re.findall(r'for label in ax\d\.get_yticklabels', source))
print(f'âœ… ticklabelsãƒ•ã‚©ãƒ³ãƒˆè¨­å®š: {count}/3ç®‡æ‰€')
"
```

### æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›

```
âœ… ticklabelsãƒ•ã‚©ãƒ³ãƒˆè¨­å®š: 3/3ç®‡æ‰€
```

---

## ğŸ“ ã¾ã¨ã‚

### å•é¡Œç‚¹
- åº—èˆ—é–“æ¯”è¼ƒã‚°ãƒ©ãƒ•ã®3ã¤ã®ã‚µãƒ–ãƒ—ãƒ­ãƒƒãƒˆï¼ˆå¹³å‡æ—¥å•†ã€å®¢å˜ä¾¡ã€ã‚®ãƒ£ãƒƒãƒ—ï¼‰ã®yè»¸ã«è¡¨ç¤ºã•ã‚Œã‚‹åº—èˆ—åãŒæ–‡å­—åŒ–ã‘

### åŸå› 
- `pandas.DataFrame.plot()` ã§ç”Ÿæˆã•ã‚Œã‚‹ticklabelsã«æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®šãŒé©ç”¨ã•ã‚Œã¦ã„ãªã‹ã£ãŸ

### è§£æ±ºç­–
- å„ã‚µãƒ–ãƒ—ãƒ­ãƒƒãƒˆã®ä½œæˆå¾Œã€`ax.get_yticklabels()` ã§å–å¾—ã—ãŸãƒ©ãƒ™ãƒ«ã« `set_fontproperties(JP_FP)` ã‚’é©ç”¨

### å½±éŸ¿ç¯„å›²
- Phase1 Cell 19 ã®ã¿ï¼ˆ3ç®‡æ‰€ä¿®æ­£ï¼‰

### ä»Šå¾Œã®äºˆé˜²ç­–
- CLAUDE.mdã« `pandas.plot()` ä½¿ç”¨æ™‚ã®ticklabelsãƒ•ã‚©ãƒ³ãƒˆè¨­å®šãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ 
- åŒæ§˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚Œã°åŒã˜ä¿®æ­£ã‚’é©ç”¨

---

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… ä¿®æ­£å®Œäº†
**ãƒ†ã‚¹ãƒˆ**: å®Ÿè¡Œå¾…ã¡ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹Jupyter Labä¸Šã§ã®å†å®Ÿè¡Œï¼‰
**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å†å®Ÿè¡Œã‚’ä¾é ¼ã—ã€æ–‡å­—åŒ–ã‘ãŒè§£æ¶ˆã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
